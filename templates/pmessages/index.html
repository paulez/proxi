{% extends "pmessages/base.html" %}

{% load url from future %}
{% load humanize %}

{% block content %}
<div class="row">
    <div class="span4">
        {% if username %}
            <form action="{% url 'pmessages.views.add' %}" method="post">
                {% csrf_token %}
                {{ message_form.non_field_errors }}
                <legend>Post a new proxy message !</legend>
                {{ message_form.message }}
                <button type="submit" class="btn">Post</button>
            </form>
        {% else %}
            <form action="{% url 'pmessages.views.login' %}" method="post">
                {% csrf_token %}
                {{ user_form.non_field_errors }}
                <legend>Chose your pseudo !</legend>
                {{ user_form.username }}
                <button type="submit" class="btn">Use</button>
            </form>
        {% endif %}
    {% if username %}
        Currently logged as {{ username }}.
        <form action="{% url 'pmessages.views.logout' %}">
            <button type="submit" class="btn-inverse">Logout</button>
        </form>
    {% endif %}
    </div>
    <div class="span8">
{% if all_messages %}
    {% for message in all_messages %}
        <div class="well well-small">
            <div class="message-text">
                <a href="{% url 'pmessages.views.detail' message.id %}">{{ message.message }}</a>
            </div>
            <div class=message-info>
                <span class="message-author">
                    Par <a href="{% url 'pmessages.views.search' message.username %}">{{ message.username }}</a>
                </span>
                <span class="message-date">
                    {{ message.date|naturaltime }}
                </span>
            </div>
        </div>
    {% endfor %}
{% else %}
    <p>No message.</p>
{% endif %}
    </div>
</div>
{% endblock %}
