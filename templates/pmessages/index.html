{% extends "pmessages/base.html" %}

{% load humanize %}
{% load pmessages_extras %}

{% block content %}
<div class="row">
    <section id="input" class="span4">
    {% if location %}
        {% if username %}
        <form action="{% url 'pmessages:message' %}" name="message_form" method="post">
            {% csrf_token %}
            <fieldset>
                <legend>Post a new proxi message within {{ radius|readable_distance }}!</legend>
            {% if message_form.non_field_errors %}
                {% for error in message_form.non_field_errors %}
                    <div class="alert alert-error">
                        {{ error|escape }}
                    </div>
                {% endfor %}
            {% endif %}
            {% if message_form.message.errors %}
                {% for error in message_form.message.errors %}
                    <div class="alert alert-error">
                        {{ error|escape }}
                    </div>
                {% endfor %}
            {% endif %}
            {{ message_form.message }}
            <button type="submit" class="btn" name="post_message">Post</button>
            </fieldset>
        </form>
        {% else %}
        <form action="{% url 'pmessages:login' %}" name="user_form" method="post">
            {% csrf_token %}
            <fieldset>
            <legend>Choose your pseudo!</legend>
            {% if user_form.non_field_errors %}
                {% for error in user_form.non_field_errors %}
                <div class="alert alert-error">
                    {{ error|escape }}
                </div>
                {% endfor %}
            {% endif %}
            {% if user_form.username.errors %}
                {% for error in user_form.username.errors %}
                <div class="alert alert-error">
                    {{ error|escape }}
                </div>
                {% endfor %}
            {% endif %}
            {{ user_form.username }}
            <button type="submit" class="btn" name="use_pseudo">Use</button>
            </fieldset>
        </form>
        {% endif %}
    {% endif %}
    {% if username %}
    Currently logged as {{ username }}.
    <form action="{% url 'pmessages:logout' %}" method="post">
        {% csrf_token %}
        <button type="submit" class="btn-inverse" name="logout">Logout</button>
    </form>
    {% endif %}
    </section>
    <section id="main" class="span8">
    {% include "pmessages/messages.html" %}
    </section>
</div>
{% endblock %}
